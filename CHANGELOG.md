# 更新日志

## [3.0.0] - 2025-09-24

### 🔗 重大修复
- **URL字段问题修复**: 发现v2.0中35%的帖子URL字段存储的是图片/视频链接而非帖子链接
- **新增post_url字段**: 专门存储标准Reddit帖子链接，保留url字段存储原始内容链接
- **数据自动修复**: 为所有1,288条现有记录自动生成正确的帖子URL

### 🐛 Bug修复
- **修复深度测试脚本**: 修复apiStats变量引用错误
- **完善错误处理**: 优化API统计数据收集和错误日志记录
- **SQL语句修复**: 更新所有采集脚本的插入语句，包含post_url字段

### 📊 数据库Schema增强
- **新增字段**: `post_url TEXT` - 标准Reddit帖子链接
- **字段说明更新**: 明确url和post_url字段的用途区别
- **向后兼容**: 保留原有url字段，确保现有查询继续工作

### 🔧 技术改进
- **采集脚本更新**: 所有采集脚本同时填充url和post_url字段
- **数据完整性**: 100%记录都有完整的链接信息
- **测试覆盖**: 增加URL字段处理的专项测试

### 📈 性能优化
- **数据准确性**: URL字段准确率从65%提升到100%
- **查询灵活性**: 支持按内容类型和讨论页分别查询
- **存储效率**: 双URL字段设计，信息更完整

## [2.0.0] - 2025-09-24

### 🚀 重大更新
- **智能增量采集**: 新增增量采集功能，自动过滤已采集数据，只获取新帖子
- **直接API操作**: 使用Cloudflare API token直接操作D1数据库，无需依赖wrangler OAuth
- **性能大幅提升**: 采集速度提升至~100帖子/分钟，数据库插入成功率100%

### ✨ 新功能
- 新增 `scripts/incremental-crawl.js` - 智能增量采集脚本
- 新增 `scripts/direct-d1-insert.js` - 直接数据库操作脚本
- 新增 `.github/workflows/daily-crawl-v2.yml` - 升级版GitHub Actions工作流
- 新增详细的采集统计和数据质量分析
- 新增批量数据插入，提升数据库写入效率

### 🔧 改进
- **数据去重**: 智能去重机制，避免重复数据采集
- **错误处理**: 增强的错误处理和重试机制
- **API限流**: 优化的API请求间隔，避免触发限制
- **数据质量**: 更严格的数据过滤和AI相关性检测
- **统计报告**: 详细的时间分布、社区贡献和质量统计

### 📊 性能数据
- **采集效率**: 单次采集1,098条高质量帖子
- **增量效率**: 新增比例14%，有效过滤重复数据
- **数据质量**: 平均分数177，评论数43，点赞率0.88
- **覆盖范围**: 25个活跃AI社区，时间跨度30天

### 🛠️ 技术改进
- 使用Node.js原生fetch API，移除外部HTTP库依赖
- 优化SQL查询，使用批量插入提升性能
- 改进的环境变量管理和配置系统
- 更好的TypeScript类型定义和代码结构

### 📋 数据库更新
- 所有表名更新为 `redditV2_` 前缀
- 优化数据库索引，提升查询性能
- 新增 `collection_batch_id` 字段用于批次追踪
- 改进的时间戳和日期字段处理

### 🤖 GitHub Actions 增强
- 支持手动选择采集类型（增量/完整）
- 自动上传采集数据为构建产物
- 实时数据库统计和通知
- 改进的错误处理和状态通知

### 🔄 脚本更新
- `npm run crawl:incremental` - 增量采集（推荐）
- `npm run crawl:full` - 完整采集
- 更新的数据库统计命令
- 改进的部署和测试脚本

### 📝 文档更新
- 全面更新的README文档
- 详细的使用指南和配置说明
- 新增故障排除和监控指南
- 完整的API参考和示例代码

---

## [1.0.0] - 2025-09-23

### 🎉 首次发布
- **基础采集功能**: 支持29个AI相关Reddit社区的数据采集
- **智能过滤**: 净赞数>10, 评论数>5, 点赞率>0.1的过滤规则
- **AI检测**: 基于关键词的AI相关性检测
- **数据存储**: Cloudflare D1数据库存储
- **定时任务**: GitHub Actions每日自动执行
- **完整架构**: 模块化设计，包含采集、处理、存储、调度模块

### 📊 初始性能
- 单次采集约1,000条帖子
- 覆盖25个活跃AI社区
- 平均数据质量评分良好
- 基础的错误处理和日志记录

### 🛠️ 技术栈
- Cloudflare Workers + D1数据库
- TypeScript开发语言
- Reddit API v2数据源
- GitHub Actions自动化

---

## 版本计划

### [2.1.0] - 计划中
- [ ] 增强AI相关性检测算法
- [ ] 添加数据分析和可视化功能
- [ ] 支持更多数据导出格式
- [ ] 添加Webhook通知支持
- [ ] 优化大规模数据处理性能

### [3.0.0] - 长期计划
- [ ] 多平台支持（Twitter, HackerNews等）
- [ ] 机器学习模型集成
- [ ] 实时数据流处理
- [ ] 高级数据分析和洞察
- [ ] Web界面和API服务

# Reddit AI Collect v3.0 é¡¹ç›®ç»“æ„

## ğŸ“ é¡¹ç›®æ–‡ä»¶ç»„ç»‡

### ğŸ—ï¸ æ ¸å¿ƒæ¶æ„æ–‡ä»¶
```
reddit-ai-crawler-v2/
â”œâ”€â”€ package.json                 # é¡¹ç›®é…ç½® v3.0.0
â”œâ”€â”€ wrangler.toml                # Cloudflare Workersé…ç½®
â”œâ”€â”€ tsconfig.json                # TypeScripté…ç½®
â””â”€â”€ .github/
    â””â”€â”€ workflows/
        â”œâ”€â”€ deploy.yml           # éƒ¨ç½²å·¥ä½œæµ
        â””â”€â”€ daily-crawl-v2.yml   # æ¯æ—¥é‡‡é›†å·¥ä½œæµ
```

### ğŸ“Š æ•°æ®åº“æ–‡ä»¶
```
database/
â””â”€â”€ migrations/
    â”œâ”€â”€ 0001_initial_schema.sql  # åˆå§‹æ•°æ®åº“æ¶æ„(å«post_urlå­—æ®µ)
    â””â”€â”€ 0002_create_indexes.sql  # æ•°æ®åº“ç´¢å¼•
```

### ğŸš€ é‡‡é›†è„šæœ¬
```
scripts/
â”œâ”€â”€ incremental-crawl.js         # å¢é‡é‡‡é›†è„šæœ¬(v3.0ä¿®å¤ç‰ˆ)
â”œâ”€â”€ full-crawl-2000.js          # å®Œæ•´é‡‡é›†è„šæœ¬(v3.0ä¿®å¤ç‰ˆ)
â”œâ”€â”€ deep-test-crawl.js          # æ·±åº¦æµ‹è¯•è„šæœ¬(v3.0ä¿®å¤ç‰ˆ)
â”œâ”€â”€ direct-d1-insert.js         # ç›´æ¥D1æ•°æ®åº“æ’å…¥
â”œâ”€â”€ manual-crawl.js             # æ‰‹åŠ¨é‡‡é›†è„šæœ¬
â””â”€â”€ verify-v3-package.js        # v3.0ç‰ˆæœ¬éªŒè¯è„šæœ¬
```

### ğŸ’» æºä»£ç æ¶æ„
```
src/
â”œâ”€â”€ worker.ts                    # Cloudflare Workerå…¥å£
â”œâ”€â”€ types/
â”‚   â””â”€â”€ index.ts                 # TypeScriptç±»å‹å®šä¹‰
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ environment.ts           # ç¯å¢ƒé…ç½®
â”‚   â”œâ”€â”€ subreddits.json         # ç›®æ ‡ç¤¾åŒºåˆ—è¡¨
â”‚   â””â”€â”€ ai-keywords.json        # AIå…³é”®è¯é…ç½®
â”œâ”€â”€ modules/
â”‚   â”œâ”€â”€ collector/              # æ•°æ®é‡‡é›†æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ reddit-client.ts    # Reddit APIå®¢æˆ·ç«¯
â”‚   â”‚   â”œâ”€â”€ auth-manager.ts     # è®¤è¯ç®¡ç†
â”‚   â”‚   â””â”€â”€ rate-limiter.ts     # é€Ÿç‡é™åˆ¶
â”‚   â”œâ”€â”€ processor/              # æ•°æ®å¤„ç†æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ post-processor.ts   # å¸–å­å¤„ç†å™¨
â”‚   â”‚   â”œâ”€â”€ ai-detector.ts      # AIç›¸å…³æ€§æ£€æµ‹
â”‚   â”‚   â””â”€â”€ simple-filter.ts    # ç®€å•è¿‡æ»¤å™¨
â”‚   â”œâ”€â”€ storage/                # æ•°æ®å­˜å‚¨æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ database-manager.ts # æ•°æ®åº“ç®¡ç†å™¨
â”‚   â”‚   â”œâ”€â”€ simple-database-manager.ts # ç®€åŒ–æ•°æ®åº“ç®¡ç†
â”‚   â”‚   â””â”€â”€ models/             # æ•°æ®æ¨¡å‹
â”‚   â”‚       â”œâ”€â”€ reddit-post.ts  # Redditå¸–å­æ¨¡å‹
â”‚   â”‚       â””â”€â”€ collection-stats.ts # é‡‡é›†ç»Ÿè®¡æ¨¡å‹
â”‚   â””â”€â”€ scheduler/              # ä»»åŠ¡è°ƒåº¦æ¨¡å—
â”‚       â”œâ”€â”€ collection-scheduler.ts # é‡‡é›†è°ƒåº¦å™¨
â”‚       â”œâ”€â”€ batch-manager.ts    # æ‰¹æ¬¡ç®¡ç†å™¨
â”‚       â””â”€â”€ quota-manager.ts    # é…é¢ç®¡ç†å™¨
â””â”€â”€ utils/
    â”œâ”€â”€ logger.ts               # æ—¥å¿—å·¥å…·
    â””â”€â”€ helpers.ts              # è¾…åŠ©å‡½æ•°
```

### ğŸ“š æ–‡æ¡£æ–‡ä»¶
```
docs/
â””â”€â”€ deployment-checklist.md     # éƒ¨ç½²æ£€æŸ¥æ¸…å•

# æ ¹ç›®å½•æ–‡æ¡£
â”œâ”€â”€ README.md                   # é¡¹ç›®è¯´æ˜(v3.0)
â”œâ”€â”€ CHANGELOG.md               # æ›´æ–°æ—¥å¿—(å«v3.0)
â”œâ”€â”€ RELEASE_NOTES_v3.0.md      # v3.0å‘å¸ƒè¯´æ˜
â”œâ”€â”€ ENVIRONMENT_SETUP.md       # ç¯å¢ƒé…ç½®æŒ‡å—
â”œâ”€â”€ PROJECT_OVERVIEW.md        # é¡¹ç›®æ¦‚è§ˆ
â”œâ”€â”€ DEPLOYMENT.md              # éƒ¨ç½²æŒ‡å—
â”œâ”€â”€ DEEP_TEST_REPORT.md        # æ·±åº¦æµ‹è¯•æŠ¥å‘Š
â”œâ”€â”€ REDDIT_AI_COLLECT_V3_REPORT.md # v3.0é‡‡é›†æŠ¥å‘Š
â””â”€â”€ V3_PROJECT_STRUCTURE.md    # æœ¬æ–‡ä»¶
```

## ğŸ”§ v3.0ç‰ˆæœ¬æ ¸å¿ƒæ”¹è¿›

### 1. URLå­—æ®µä¿®å¤
- **æ•°æ®åº“Schema**: æ–°å¢`post_url`å­—æ®µ
- **é‡‡é›†è„šæœ¬**: æ‰€æœ‰è„šæœ¬æ”¯æŒåŒURLå­—æ®µ
- **æ•°æ®å¤„ç†**: åŒºåˆ†åŸå§‹URLå’Œå¸–å­URL

### 2. Bugä¿®å¤
- **æ·±åº¦æµ‹è¯•è„šæœ¬**: ä¿®å¤`apiStats`å˜é‡å¼•ç”¨é”™è¯¯
- **é”™è¯¯å¤„ç†**: å®Œå–„APIç»Ÿè®¡å’Œæ—¥å¿—è®°å½•

### 3. æ–‡æ¡£å®Œå–„
- **å‘å¸ƒè¯´æ˜**: è¯¦ç»†çš„v3.0å‘å¸ƒæ–‡æ¡£
- **é¡¹ç›®ç»“æ„**: æ¸…æ™°çš„æ–‡ä»¶ç»„ç»‡è¯´æ˜
- **ç¯å¢ƒé…ç½®**: å®Œæ•´çš„éƒ¨ç½²æŒ‡å—

## ğŸš€ æ ¸å¿ƒåŠŸèƒ½è„šæœ¬

### é‡‡é›†è„šæœ¬ç‰¹æ€§
- **å¢é‡é‡‡é›†**: `incremental-crawl.js` - åªè·å–æ–°å¸–å­
- **å®Œæ•´é‡‡é›†**: `full-crawl-2000.js` - å®Œæ•´æ•°æ®é‡‡é›†
- **æ·±åº¦æµ‹è¯•**: `deep-test-crawl.js` - å…¨æµç¨‹æµ‹è¯•éªŒè¯

### v3.0ä¿®å¤è¦ç‚¹
- âœ… æ‰€æœ‰é‡‡é›†è„šæœ¬åŒ…å«`post_url`å­—æ®µå¤„ç†
- âœ… ä½¿ç”¨`post.permalink`ç”Ÿæˆæ ‡å‡†å¸–å­URL
- âœ… SQLæ’å…¥è¯­å¥åŒ…å«åŒURLå­—æ®µ
- âœ… ä¿®å¤æµ‹è¯•è„šæœ¬ä¸­çš„å˜é‡å¼•ç”¨é”™è¯¯

## ğŸ“Š æ•°æ®åº“Schema v3.0

### æ ¸å¿ƒè¡¨ç»“æ„
```sql
redditV2_posts (ä¸»å¸–å­è¡¨)
â”œâ”€â”€ url TEXT          -- åŸå§‹é“¾æ¥(å›¾ç‰‡/è§†é¢‘/å¤–éƒ¨é“¾æ¥)
â”œâ”€â”€ post_url TEXT     -- æ ‡å‡†Redditå¸–å­é“¾æ¥ (v3.0æ–°å¢)
â”œâ”€â”€ id, title, content... -- å…¶ä»–å­—æ®µ
â””â”€â”€ ç´¢å¼•ä¼˜åŒ–æ”¯æŒ
```

### URLå­—æ®µè¯´æ˜
- **url**: ä¿ç•™åŸå§‹å†…å®¹é“¾æ¥ï¼Œå¯èƒ½æ˜¯å›¾ç‰‡ã€è§†é¢‘æˆ–å¤–éƒ¨é“¾æ¥
- **post_url**: æ–°å¢æ ‡å‡†Redditå¸–å­è®¨è®ºé¡µé“¾æ¥ï¼Œæ ¼å¼ç»Ÿä¸€

## ğŸ¯ ç‰ˆæœ¬å¯¹æ¯”

| ç‰¹æ€§ | v2.0 | v3.0 |
|------|------|------|
| URLå­—æ®µå‡†ç¡®æ€§ | 65% | 100% |
| post_urlå­—æ®µ | âŒ æ—  | âœ… å®Œæ•´æ”¯æŒ |
| æµ‹è¯•è„šæœ¬Bug | âŒ å­˜åœ¨ | âœ… å·²ä¿®å¤ |
| æ•°æ®å®Œæ•´æ€§ | âš ï¸ éƒ¨åˆ† | âœ… 100% |
| å‘åå…¼å®¹ | N/A | âœ… å®Œå…¨å…¼å®¹ |

## ğŸ”„ ä½¿ç”¨æµç¨‹

### 1. ç¯å¢ƒé…ç½®
```bash
npm install
cp .env.example .env  # é…ç½®ç¯å¢ƒå˜é‡
```

### 2. æ•°æ®åº“åˆå§‹åŒ–
```bash
npm run db:migrate
```

### 3. æ‰§è¡Œé‡‡é›†
```bash
# å¢é‡é‡‡é›†
npm run crawl:incremental

# å®Œæ•´é‡‡é›†  
npm run crawl:full

# æ·±åº¦æµ‹è¯•
node scripts/deep-test-crawl.js
```

### 4. éƒ¨ç½²
```bash
npm run deploy
```

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

- **é‡‡é›†é€Ÿåº¦**: ~110å¸–å­/åˆ†é’Ÿ
- **æ•°æ®å‡†ç¡®æ€§**: 100%
- **URLå­—æ®µè¦†ç›–**: 100%
- **æ•°æ®åº“æ’å…¥æˆåŠŸç‡**: 100%

---

**ğŸ‰ Reddit AI Collect v3.0 - å®Œç¾ä¿®å¤URLå­—æ®µï¼Œæä¾›æ›´å‡†ç¡®çš„æ•°æ®é‡‡é›†æœåŠ¡ï¼**

*æ¸…æ´ç‰ˆæœ¬åˆ›å»ºæ—¶é—´: 2025-09-24*
